var pur=pur||{},preSelectedVendorId,preSelectedAddressId;pur.Purchasing=function(a){this._options={moreItemInfoAction:"",vendorRequiredWarning:"You must select a vendor.",deliveryLocationRequiredWarning:'You must select a "Delivery Location" address.',multipleApproverWarning:"PLEASE NOTE: When multiple approvers are selected, your request will not be placed until all approvals are collected. If your primary approver is out of office, adding another approver will not speed up the approval process.",onBeforeUnloadWarning:"If you continue without saving, you may lose your work.",noItemsWarning:"You must enter at least one item.",taxRate:8.25,unloadOkay:false};pur.extend(this._options,a);this._init()};pur.Purchasing.prototype={_init:function(){var a=this,b=0;window.onbeforeunload=function(){if(!a._options.unloadOkay){return a._options.onBeforeUnloadWarning}};this._updateItemMoreInfoLink();$("#submit-request input, #save-request input").click(function(c){a._onSubmit(c)});$("#add-approver").click(function(c){a._onAddApprover(this,c)});$("#add-vendor").click(function(c){a._onAddVendor(c)});$("#add-address").click(function(c){a._onAddAddress(c)});$(window).load(function(){a._outputTotal()});$("#add-item").click(function(c){a._onAddItem(this,c)});$(".more-item-info").click(function(c){a._onMoreItemOpening(this,c)});$("input[name$=PricePerUnit-text]").live("blur",function(){a._outputTotal()});$("div[id$=PricePerUnit] a").live("click",function(){a._outputTotal()});$("input[name$=Quantity-text]").live("blur",function(){a._outputTotal()});$("div[id$=Quantity] a").live("click",function(){a._outputTotal()})},_onSubmit:function(h){var c=this,g,a;var d=$("#Request_VendorId").data("tComboBox").value();if(d.length==0){alert(c._options.vendorRequiredWarning);h.preventDefault();return}else{if(/^ *[0-9]+ *$/.test(d)==false){g=$("#add-vendor-frame")[0];a=g.src.toString();if(a.indexOf("?")!=-1){a=a.substr(0,a.indexOf("?"))}g.src=a+"?name="+escape(d);$("#AddVendor").data("tWindow").center().open();h.preventDefault();return}}var f=$("#Request_ShipToId").data("tComboBox").value();if(f.length==0){alert(c._options.deliveryLocationRequiredWarning);h.preventDefault();return}else{if(/^ *[0-9]+ *$/.test(f)==false){g=$("#add-address-frame")[0];a=g.src.toString();if(a.indexOf("?")!=-1){a=a.substr(0,a.indexOf("?"))}g.src=a+"?name="+escape(f);$("#AddAddress").data("tWindow").center().open();h.preventDefault();return}}var b=true;$(".item-row").each(function(){if(!c._isItemRowEmpty($(this))){b=false}});if(b){alert(c._options.noItemsWarning);h.preventDefault();return}$($(".item-row").get().reverse()).each(function(e){if(c._isItemRowEmpty($(this))){$(this).remove()}else{return false}});c._options.unloadOkay=true;h.stopPropagation()},_onAddApprover:function(a,b){if(confirm(this._options.multipleApproverWarning)){$(".approver-hidden:first").fadeIn().removeClass("approver-hidden");if($(".approver-hidden").size()==0){$(a).hide()}}b.preventDefault();b.stopPropagation()},_onAddVendor:function(c){var b=$("#add-vendor-frame")[0],a=b.src.toString();if(a.indexOf("?")!=-1){a=a.substr(0,a.indexOf("?"))}b.src=a;$("#AddVendor").data("tWindow").center().open();c.preventDefault();c.stopPropagation()},_reloadVendors:function(a){preSelectedVendorId=a;var b=$("#Request_VendorId").data("tComboBox");b.reload();$(".t-window").each(function(){$("#"+$(this).attr("id")).data("tWindow").close()})},_onVendorsDataBound:function(c){var b=$(this).data("tComboBox");var a=function(d){if(!preSelectedVendorId){return false}return d.Value==preSelectedVendorId};b.select(a);preSelectedVendorId=null},_onAddAddress:function(c){var b=$("#add-address-frame")[0],a=b.src.toString();if(a.indexOf("?")!=-1){a=a.substr(0,a.indexOf("?"))}b.src=a;$("#AddAddress").data("tWindow").center().open();c.preventDefault();c.stopPropagation()},_reloadAddresses:function(a){preSelectedAddressId=a;var b=$("#Request_ShipToId").data("tComboBox");b.reload();$(".t-window").each(function(){$("#"+$(this).attr("id")).data("tWindow").close()})},_onAddressesDataBound:function(c){var b=$(this).data("tComboBox");var a=function(d){if(!preSelectedAddressId){return false}return d.Value==preSelectedAddressId};b.select(a);preSelectedAddressId=null},_onAddItem:function(a,b){$(".item-hidden:first").fadeIn().removeClass("item-hidden");if($(".item-hidden").size()==0){$(a).hide()}b.preventDefault();b.stopPropagation()},_onMoreItemOpening:function(a,g){var b=$(".more-item-info").index($(a)),c=$(a).parent().find("input[name$=Url]").val(),f=$(a).parent().find("input[name$=Notes]").val(),d=$(a).parent().find("input[name$=PromoCode]").val(),h=$(a).parent().find("input[name$=CommodityTypeId]").val();$("#MoreItemInfoWindow .t-window-content").html('<iframe src="'+this._options.moreItemInfoAction+"?Index="+b+"&Url="+escape(c)+"&Notes="+escape(f)+"&CommodityTypeId="+h+"&PromoCode="+escape(d)+'" style="width: 100%; height: 100%;" frameborder="0"></iframe>');$("#MoreItemInfoWindow").data("tWindow").center().open()},_isItemRowEmpty:function(a){var c=$(a).find("div[id$=Quantity]").data("tTextBox").value(),b=$(a).find("input[name$=Unit]").val(),f=$(a).find("input[name$=CatalogNumber]").val(),d=$(a).find("input[name$=Description]").val(),e=$(a).find("div[id$=PricePerUnit]").data("tTextBox").value();if(c==null&&e==null&&b==="each"&&(f+d).length==0){return true}else{return false}},_updateItemMoreInfoLink:function(){$(".item-row").each(function(){var c=$(".item-row").index($(this));var a=$(this).find("input[name$=Url]").val();var d=$(this).find("input[name$=Notes]").val();var b=$(this).find("input[name$=PromoCode]").val();if((a+d+b).length>0){$(this).find(".more-item-info").attr("src","/Content/Img/Fugue/document--pencil.png").attr("title","Edit additional information for this item")}else{$(this).find(".more-item-info").attr("src","/Content/Img/Fugue/document--plus.png").attr("title","Add additional information to this item")}if($(this).find(".more-item-info").parent("td").find(".input-validation-error").size()>0){$(this).find(".more-item-info").addClass("invalid-icon")}else{$(this).find(".more-item-info").removeClass("invalid-icon")}})},_onItemChange:function(a){$(this).data("tTextBox").value(a.newValue);pur.Purchasing.prototype._outputTotal()},_outputTotal:function(){var a=0;$(".item-row").each(function(){var b=$(this).find("div[id$=Quantity]").data("tTextBox").value();var c=$(this).find("div[id$=PricePerUnit]").data("tTextBox").value();if(b&&c){a+=b*c}});$("#subtotal").html(this._formatNumber(a,2))},_formatNumber:function(b,c){var a=1;for(i=1;i<=c;i++){a=a*10}return"$"+((Math.round(b*a)/a)*((this._options.taxRate/100)+1)).toFixed(c)}};pur.extend=function(c,a){for(var b in a){c[b]=a[b]}};